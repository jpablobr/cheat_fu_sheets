<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>postgresql(1) - cheat_fu sheets</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#NAME">NAME</a>
    <a href="#Setup">Setup</a>
    <a href="#Administration">Administration</a>
    <a href="#Basic-Server-Setup">Basic Server Setup</a>
    <a href="#Create-database">Create database</a>
    <a href="#Alternative-Server-Setup">Alternative Server Setup</a>
    <a href="#Managing-users-and-rights">Managing users and rights</a>
    <a href="#restarting-the-server">restarting the server</a>
    <a href="#Troubleshooting">Troubleshooting</a>
    <a href="#LINKS">LINKS</a>
    <a href="#development-test-production-">development/test/production:</a>
    <a href="#Setup">Setup</a>
    <a href="#Concurrency-">Concurrency:</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>postgresql(1)</li>
    <li class='tc'></li>
    <li class='tr'>postgresql(1)</li>
  </ol>

  <h2 id="NAME">NAME</h2>
<p class="man-name">
  <code>postgresql</code> - <span class="man-whatis">cheat_fu sheets</span>
</p>

<h2 id="Setup">Setup</h2>

<pre><code>sudo apt-get install postgresql
</code></pre>

<h2 id="Administration">Administration</h2>

<p>pgAdmin III is a handy GUI for PostgreSQL, it is essential to
beginners. To install it, type at the command line:</p>

<pre><code>sudo apt-get install pgadmin3
</code></pre>

<h2 id="Basic-Server-Setup">Basic Server Setup</h2>

<p>To start off, we need to change the PostgreSQL postgres user password;
we will not be able to access the server otherwise. As the “postgres”
Linux user, we will execute the psql command.</p>

<p>In a terminal, type:</p>

<pre><code>sudo -u postgres psql template1

sudo -u postgres psql postgres
</code></pre>

<p>Set a password for the "postgres" database role using the command:</p>

<pre><code>\password postgres
</code></pre>

<p>Type Control+D to exit the posgreSQL prompt.</p>

<h2 id="Create-database">Create database</h2>

<p>To create the first database, which we will call "mydb", simply type :</p>

<pre><code>sudo -u postgres createdb mydb
</code></pre>

<h2 id="Alternative-Server-Setup">Alternative Server Setup</h2>

<p>If you don't intend to connect to the database from other machines, this
alternative setup may be simpler.</p>

<p>By default in Ubuntu, Postgresql is configured to use 'ident sameuser'
authentication for any connections from the same machine. Check out the
excellent Postgresql documentation for more information, but essentially
this means that if your Ubuntu username is 'foo' and you add 'foo' as a
Postgresql user then you can connect to the database without requiring a
password.</p>

<p>Since the only user who can connect to a fresh install is the postgres
user, here is how to create yourself a database account (which is in
this case also a database superuser) with the same name as your login
name and then create a password for the user:</p>

<pre><code> sudo -u postgres createuser --superuser $USER
 sudo -u postgres psql

 postgres=# \password $USER
</code></pre>

<p>Client programs, by default, connect to the local host using your Ubuntu
login name and expect to find a database with that name too. So to make
things REALLY easy, use your new superuser privileges granted above to
create a database with the same name as your login name:</p>

<pre><code> createdb $USER
</code></pre>

<p>Connecting to your own database to try out some SQL should now be as easy as:</p>

<pre><code> psql
</code></pre>

<p>Creating additional database is just as easy, so for example, after
running this:</p>

<pre><code> createdb amarokdb
</code></pre>

<h2 id="Managing-users-and-rights">Managing users and rights</h2>

<p>To manage users, you first have to edit
/etc/postgresql/8.1/main/pg_hba.conf and modify the default
configuration which is very protective. For example, if you want
postgres to manage its own users (not linked with system users), you
will add the following line:</p>

<p>8&lt;-------------------------------------------</p>

<h1>TYPE  DATABASE    USER        IP-ADDRESS        IP-MASK           METHOD</h1>

<p>host    all         all         10.0.0.0       255.255.255.0    md5
8&lt;-------------------------------------------</p>

<p>Which means that on your local network (10.0.0.0/24 - replace with your
own local network !), postgres users can connect through the network to
the database providing a classical couple user / password.</p>

<p>To create a database with a user that have full rights on the database,
use the following</p>

<pre><code>sudo -u postgres createuser -D -A -P myuser
sudo -u postgres createdb -O myuser mydb
</code></pre>

<p>The first command line creates the user with no database creation rights
(-D) with no add user rights -A) and will prompt you for entering a
password (-P). The second command line create the database 'mydb with
'myuser' as owner.</p>

<h2 id="restarting-the-server">restarting the server</h2>

<pre><code>sudo /etc/init.d/postgresql-8.3 restart
</code></pre>

<h2 id="Troubleshooting">Troubleshooting</h2>

<p>If you’re receiving the error:</p>

<p>FATAL C28000 MIDENT authentication failed for user "todo" Fauth.c L395
Rauth_failed it is due to Rails connecting to PostgreSQL via TCP socket,
not UNIX socket, so in the pg_hba.conf you need to setup a “host” line,
not a “local” line.</p>

<p>So, something like:</p>

<pre><code>  host all all 127.0.0.1 255.255.255.255 password
</code></pre>

<p>or</p>

<pre><code>host all all 127.0.0.1 255.255.255.255 trust
</code></pre>

<p>Also make sure that your PostgreSQL is listening to TCP/IP requests. If
you are starting PostgreSQL via pg_ctl simply add ‘-o -i’ to the end of
the line. On OS X my PostgreSQL start command looks like this:</p>

<pre><code>/usr/local/pgsql/bin/pg_ctl -D /usr/local/pgsql/data  -l logfile start -o -i
</code></pre>

<p>Under a stock Ubuntu install, you will probably encounter either of these errors:
e_sendauth: no password supplied</p>

<pre><code>fe_sendauth: no password supplied
</code></pre>

<p>This is due to the permissions in pg_hba.conf being too restrictive by
default. To allow rails to connect, simply change the bottom of
pg_hba.conf to look like this.</p>

<h1>TYPE  DATABASE    USER        CIDR-ADDRESS          METHOD</h1>

<h1>"local" is for Unix domain socket connections only</h1>

<p>local   all         all                               trust</p>

<h1>IPv4 local connections:</h1>

<p>host    all         all         127.0.0.1/32          trust</p>

<h1>IPv6 local connections:</h1>

<p>host    all         all         ::1/128               trust</p>

<h2 id="LINKS">LINKS</h2>

<h2 id="development-test-production-">development/test/production:</h2>

<p>  adapter: postgresql
  database: postgresql-env
  username: user
  password: pass
  host: 127.0.0.1</p>

<h2 id="Setup">Setup</h2>

<p><a href="http://oldwiki.rubyonrails.org/rails/pages/PostgreSQL" data-bare-link="true">http://oldwiki.rubyonrails.org/rails/pages/PostgreSQL</a></p>

<h2 id="Concurrency-">Concurrency:</h2>

<p><a href="http://devcenter.heroku.com/articles/postgresql-concurrency" data-bare-link="true">http://devcenter.heroku.com/articles/postgresql-concurrency</a></p>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'></li>
    <li class='tc'>May 2011</li>
    <li class='tr'>postgresql(1)</li>
  </ol>

  </div>
</body>
</html>

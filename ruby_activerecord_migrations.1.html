<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>ruby_activerecord_migrations(1) - Ruby Active Record Migrations</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#Methods-">Methods:</a>
    <a href="#Available-Column-Types-">Available Column Types:</a>
    <a href="#Valid-Column-Options-">Valid Column Options:</a>
    <a href="#Rake-Tasks-">Rake Tasks:</a>
    <a href="#SQL-">SQL:</a>
    <a href="#Example-Migration-">Example Migration:</a>
    <a href="#Find-Highest-version-">Find Highest version:</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>ruby_activerecord_migrations(1)</li>
    <li class='tc'></li>
    <li class='tr'>ruby_activerecord_migrations(1)</li>
  </ol>

  <h1>Ruby Active Record Migrations</h1>
<h2 id="Methods-">Methods:</h2>

<p><code>create_table</code>(name, options)                            <br />
<code>drop_table</code>(name)                                       <br />
<code>rename_table</code>(old_name, new_name)                       <br />
<code>add_column</code>(table_name, column_name, type, options)     <br />
<code>rename_column</code>(table_name, column_name, new_column_name)<br />
<code>change_column</code>(table_name, column_name, type, options)  <br />
<code>remove_column</code>(table_name, column_name)                 <br />
<code>add_index</code>(table_name, column_name, index_type)         <br />
<code>remove_index</code>(table_name, column_name)                  <br /></p>

<h2 id="Available-Column-Types-">Available Column Types:</h2>

<p><var>integer                    </var><br />
<var>float                      </var><br />
<var>datetime                   </var><br />
<var>date                       </var><br />
<var>timestamp                  </var><br />
<var>time                       </var><br />
<var>text                       </var><br />
<var>string                     </var><br />
<var>binary                     </var><br />
<var>boolean                    </var><br />
<var>decimal                    </var>
:precision :scale<br /></p>

<h2 id="Valid-Column-Options-">Valid Column Options:</h2>

<p><code>limit</code><br />
<code>null</code> (i.e. ":null => false" implies NOT NULL)<br />
<code>default</code> (to specify default values)<br />
<code>:decimal</code>, :precision => 8, :scale => 3<br /></p>

<h2 id="Rake-Tasks-">Rake Tasks:</h2>

<p><code>rake db:schema:dump</code>: run after you create a model to capture the schema.rb<br />
<code>rake db:schema:import</code>: import the schema file into the current database (on error, check if your schema.rb has ":force => true" on the create table statements<br />
<code>./script/generate migration MigrationName</code>: generate a new migration with a new 'highest' version (run './script/generate migration' for this info at your fingertips)<br />
<code>rake db:migrate</code>: migrate your current database to the most recent version<br />
<code>rake db:migrate VERSION=5</code>: migrate your current database to a specific version (in this case, version 5)<br />
<code>rake db:rollback</code>: migrate down one migration<br />
<code>rake db:rollback STEP=3</code>: migrate down three migrations<br />
<code>rake db:migrate RAILS_ENV=production</code>: migrate your production database<br /></p>

<h2 id="SQL-">SQL:</h2>

<p>  Queries can be executed directly:<br />
  execute <var>'ALTER TABLE researchers ADD CONSTRAINT fk_researchers_departments FOREIGN KEY ( department_id ) REFERENCES departments( id )'</var><br /></p>

<h2 id="Example-Migration-">Example Migration:</h2>

<pre><code>class UpdateUsersAndCreateProducts &lt; ActiveRecord::Migration
  def self.up
    rename_column "users", "password", "hashed_password"
    remove_column "users", "email"

     User.reset_column_information
     User.find(:all).each{|u| #do something with u}

    create_table "products", :force =&gt; true do |t|
        t.column "name", :text
        t.column "description", :text
        t.column "price", :decimal, :precision =&gt; 9, :scale =&gt; 2
    end

    #the rails 2.0 way:
    create_table :people do |t|
      t.integer :account_id
      t.string  :first_name, :last_name, :null =&gt; false
      t.text    :description
      t.timestamps
    end
  end

  def self.down
    rename_column "users", "hashed_password", "password"
    add_column "users", "email", :string
    drop_table "products"
  end
end
</code></pre>

<h2 id="Find-Highest-version-">Find Highest version:<br /></h2>

<p>script/runner "puts ActiveRecord::Migrator.current_version"</p>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'></li>
    <li class='tc'>July 2011</li>
    <li class='tr'>ruby_activerecord_migrations(1)</li>
  </ol>

  </div>
</body>
</html>

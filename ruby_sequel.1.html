<!DOCTYPE html>
<html>
<head>
  <meta http-equiv='content-type' value='text/html;charset=utf8'>
  <meta name='generator' value='Ronn/v0.7.3 (http://github.com/rtomayko/ronn/tree/0.7.3)'>
  <title>ruby_sequel(1) - Ruby Sequel</title>
  <style type='text/css' media='all'>
  /* style: man */
  body#manpage {margin:0}
  .mp {max-width:100ex;padding:0 9ex 1ex 4ex}
  .mp p,.mp pre,.mp ul,.mp ol,.mp dl {margin:0 0 20px 0}
  .mp h2 {margin:10px 0 0 0}
  .mp > p,.mp > pre,.mp > ul,.mp > ol,.mp > dl {margin-left:8ex}
  .mp h3 {margin:0 0 0 4ex}
  .mp dt {margin:0;clear:left}
  .mp dt.flush {float:left;width:8ex}
  .mp dd {margin:0 0 0 9ex}
  .mp h1,.mp h2,.mp h3,.mp h4 {clear:left}
  .mp pre {margin-bottom:20px}
  .mp pre+h2,.mp pre+h3 {margin-top:22px}
  .mp h2+pre,.mp h3+pre {margin-top:5px}
  .mp img {display:block;margin:auto}
  .mp h1.man-title {display:none}
  .mp,.mp code,.mp pre,.mp tt,.mp kbd,.mp samp,.mp h3,.mp h4 {font-family:monospace;font-size:14px;line-height:1.42857142857143}
  .mp h2 {font-size:16px;line-height:1.25}
  .mp h1 {font-size:20px;line-height:2}
  .mp {text-align:justify;background:#fff}
  .mp,.mp code,.mp pre,.mp pre code,.mp tt,.mp kbd,.mp samp {color:#131211}
  .mp h1,.mp h2,.mp h3,.mp h4 {color:#030201}
  .mp u {text-decoration:underline}
  .mp code,.mp strong,.mp b {font-weight:bold;color:#131211}
  .mp em,.mp var {font-style:italic;color:#232221;text-decoration:none}
  .mp a,.mp a:link,.mp a:hover,.mp a code,.mp a pre,.mp a tt,.mp a kbd,.mp a samp {color:#0000ff}
  .mp b.man-ref {font-weight:normal;color:#434241}
  .mp pre {padding:0 4ex}
  .mp pre code {font-weight:normal;color:#434241}
  .mp h2+pre,h3+pre {padding-left:0}
  ol.man-decor,ol.man-decor li {margin:3px 0 10px 0;padding:0;float:left;width:33%;list-style-type:none;text-transform:uppercase;color:#999;letter-spacing:1px}
  ol.man-decor {width:100%}
  ol.man-decor li.tl {text-align:left}
  ol.man-decor li.tc {text-align:center;letter-spacing:4px}
  ol.man-decor li.tr {text-align:right;float:right}
  </style>
</head>
<!--
  The following styles are deprecated and will be removed at some point:
  div#man, div#man ol.man, div#man ol.head, div#man ol.man.

  The .man-page, .man-decor, .man-head, .man-foot, .man-title, and
  .man-navigation should be used instead.
-->
<body id='manpage'>
  <div class='mp' id='man'>

  <div class='man-navigation' style='display:none'>
    <a href="#gem-install-sequel">gem install sequel</a>
    <a href="#Open-a-database">Open a database</a>
    <a href="#or">or</a>
    <a href="#SQLite-memory-DB">SQLite memory DB</a>
    <a href="#Create-a-dataset">Create a dataset</a>
    <a href="#Datasets-and-chainability">Datasets and chainability</a>
    <a href="#Retrieve-rows">Retrieve rows</a>
    <a href="#Dataset-is-Enumerable">Dataset is Enumerable</a>
    <a href="#Filtering">Filtering</a>
    <a href="#Get-the-first-record-that-matches-a-condition">Get the first record that matches a condition</a>
    <a href="#Filter-using-a-subquery">Filter using a subquery</a>
    <a href="#Ordering">Ordering</a>
    <a href="#Row-ranges">Row ranges</a>
    <a href="#Pagination">Pagination</a>
    <a href="#Joins">Joins</a>
    <a href="#Summarizing">Summarizing</a>
    <a href="#Schema-Manipulation">Schema Manipulation</a>
    <a href="#Row-manipulation">Row manipulation</a>
    <a href="#Aliasing">Aliasing</a>
    <a href="#Modeling">Modeling</a>
  </div>

  <ol class='man-decor man-head man head'>
    <li class='tl'>ruby_sequel(1)</li>
    <li class='tc'></li>
    <li class='tr'>ruby_sequel(1)</li>
  </ol>

  <h1>Ruby Sequel</h1>
<h2 id="gem-install-sequel">gem install sequel</h2>

<pre><code>require 'sequel/mysql'
require 'sequel/ado'
require 'sequel/sqlite'
</code></pre>

<h2 id="Open-a-database">Open a database</h2>

<pre><code>DB = Sequel('sqlite:///my_blog.db')
DB = Sequel('postgres://user:password@localhost/my_db')
DB = Sequel('mysql://user:password@localhost/my_db')
</code></pre>

<h2 id="or">or</h2>

<pre><code>DB = Sequel.open 'mysql://user:password@localhost/my_db'
DB = Sequel.mysql 'user@localhost/my_db', :password =&gt; 'password'

DB = Sequel.ado 'mydb'
</code></pre>

<h2 id="SQLite-memory-DB">SQLite memory DB</h2>

<pre><code>DB = Sequel('sqlite:/')
DB = Sequel.sqlite
</code></pre>

<h2 id="Create-a-dataset">Create a dataset</h2>

<pre><code>dataset = DB[:items]
dataset = DB.dataset.from(:items)
</code></pre>

<h2 id="Datasets-and-chainability">Datasets and chainability</h2>

<pre><code>dataset = DB[:managers].where(:salary =&gt; 5000..10000).order(:name, :department)
</code></pre>

<h2 id="Retrieve-rows">Retrieve rows</h2>

<pre><code>dataset.each {|r| p r}
dataset.all #=&gt; [...]
dataset.first
dataset.order(:name).last # works only for ordered datasets
</code></pre>

<h2 id="Dataset-is-Enumerable">Dataset is Enumerable</h2>

<pre><code>dataset.map {|r| r[:name]}
dataset.map(:name) # same effect as above

dataset.inject {|sum, r| sum + r[:value]}
</code></pre>

<h2 id="Filtering">Filtering</h2>

<pre><code>dataset.filter(:name =&gt; 'abc')
dataset.filter('name = ?', 'abc')
dataset.filter {name = 'abc'}

dataset.filter {value &gt; 100}
dataset.exclude {value &lt;= 100}

dataset.filter(:value =&gt; 50..100)
dataset.where {value &gt;= 50}.and {value &lt;= 100}

dataset.where('value IN (?)', [50,75,100])
</code></pre>

<h2 id="Get-the-first-record-that-matches-a-condition">Get the first record that matches a condition</h2>

<pre><code>dataset[:name =&gt; 'abc'] # Same as:
dataset.filter(:name =&gt; 'abc').first
</code></pre>

<h2 id="Filter-using-a-subquery">Filter using a subquery</h2>

<pre><code>dataset.filter('price &gt; ?', dataset.select('AVG(price) + 100'))
</code></pre>

<h2 id="Ordering">Ordering</h2>

<pre><code>dataset.order(:kind)
dataset.reverse_order(:kind)
dataset.order(:kind.DESC, :name)
</code></pre>

<h2 id="Row-ranges">Row ranges</h2>

<pre><code>dataset.limit(30)
dataset.limit(30).offset(10)
dataset.limit(30, 10) # Same effect as above
</code></pre>

<h2 id="Pagination">Pagination</h2>

<pre><code>paginated = dataset.paginate(1, 10) # first page, 10 rows per page
paginated.page_count #=&gt; number of pages in dataset
paginated.current_page #=&gt; 1
paginated.next_page #=&gt; next page number or nil
paginated.prev_page #=&gt; previous page number or nil
</code></pre>

<h2 id="Joins">Joins</h2>

<pre><code>DB[:items].left_outer_join(:categories, :id =&gt; :category_id).sql #=&gt;
  "SELECT * FROM items LEFT OUTER JOIN categories ON categories.id = items.category_id"
</code></pre>

<h2 id="Summarizing">Summarizing</h2>

<pre><code>dataset.count #=&gt; record count
dataset.max(:price)
dataset.min(:price)
dataset.avg(:price)
dataset.sum(:stock)

dataset.group(:category).select(:category, :price.AVG)
</code></pre>

<h2 id="Schema-Manipulation">Schema Manipulation</h2>

<pre><code>DB.create_table :items do
  integer :id, :primary_key =&gt; true, :auto_increment =&gt; true
  text :name, :unique =&gt; true, :null =&gt; false
  boolean :active, :default =&gt; true
  integer :grade

  index :grade
end

DB.drop_table :items
</code></pre>

<h2 id="Row-manipulation">Row manipulation</h2>

<pre><code>dataset.filter(:active =&gt; false).delete

dataset.filter('price &lt; ?', 100).update(:active =&gt; true)

dataset.insert(:name =&gt; 'Sharon', :grade=&gt; 50)
dataset &lt;&lt; {:name =&gt; 'Sharon', :grade =&gt; 50} # same effect as above
</code></pre>

<h2 id="Aliasing">Aliasing</h2>

<pre><code>DB[:items].select(:name.AS(:item_name))
DB[:items].select(:name =&gt; :item_name)
DB[:items].select(:name___item_name)
DB['items items_table'].select(:items_table__name___item_name)
</code></pre>

<h2 id="Modeling">Modeling</h2>

<pre><code>class Item &lt; Sequel::Model(:items)
  set_schema do
    primary_key :id
    text :name, :unique =&gt; true, :null =&gt; false
    boolean :active, :default =&gt; true
    integer :grade

    index :grade
  end
end

Item.create_table unless Item.table_exists?
Item.recreate_table

i = Item.create(:name =&gt; 'Shoes', :grade =&gt; 0)

Item[1].grade #=&gt; 0

i.set(:grade =&gt; 2)
i.grade #=&gt; 2

Item[:name =&gt; 'Shoes'].grade #=&gt; 2

i.grade = 4
Item[1].grade #=&gt; 2
i.save
Item[1].grade #=&gt; 4

Miscellaneous

dataset.sql #=&gt; "SELECT * FROM items"
dataset.delete_sql #=&gt; "DELETE FROM items"
dataset.where(:name =&gt; 'sequel').exists #=&gt; "EXISTS ( SELECT 1 FROM items WHERE name = 'sequel' )"
dataset.print #=&gt; pretty table print
dataset.columns #=&gt; array of columns in the result set
</code></pre>


  <ol class='man-decor man-foot man foot'>
    <li class='tl'></li>
    <li class='tc'>July 2011</li>
    <li class='tr'>ruby_sequel(1)</li>
  </ol>

  </div>
</body>
</html>
